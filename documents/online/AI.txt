08.11.11:
И так всё таки выделил отдельный файл под АИ...видно на долго затянется работа над полной его активацией в мп...что мы видим просто подключив CAI_Space:
1. монстры НЕ двигаются, стоят на месте и некоторые видя игрока начинают его атаковать...
2. сталкеры ходят, на игрока не реагируют пока тот не стрельнет в сталкера, и то они не отстреливаются, такое чувство будто они знают откуда стреляли и ходят пялятся туда пытаясь кого нибудь увидеть...

Разница МП с Синглом:
1. В сингле доступен полный класс CAlifeSimulator
2. В сингле задействована куча самых разных скриптов нахрен не нужных в мп...

Всё равно думаю что причина неполноценного АИ в мп в скриптах...покапаюсь чуток в скриптах относящихся к самим ServerEntity..
se_stalker.script:
Видим:
--' Отключаем старый метод выбора смарттеррейнов.
self:brain():can_choose_alife_tasks(false)

self:brain() - обращение к "мозгам" про которые я писал в monster sync...CALifeHumanBrain...думаю это всё таки имеет отношение к работоспособности АИ...предположим что включим этот старый метод выбора смарттеррейнов, что будет?и что за смарттеррейны?и видим дальше:
--' Выбор смарта
local smart = utils.cfg_get_string(obj_ini, "logic", "smart_terrain", self, false, "", "")
local smart_obj = self.board:get_smart_by_name(smart)
if smart_obj == nil then
	return
end
смарттеррейн это логика объекта?ладно, попробуем со старого метода...

какогото чёрта se_stalker:__init вызывается 3 раза и потом сервер падает...что за бредятина???

В сингле создание сталкера у сервера выглядит примерно так:
se_stalker:__initse_stalker:on_before_registerse_stalker:on_registerregistering stalker sim_default_zombied_111899 se_stalker:on_spawnRegister sm npc [squad_zombied_sim_squad_novice]:[11899][smart_terrain pri_sim_4] register called obj=sim_default_zombied_111887filling npc_info for obj [sim_default_zombied_111887][smart_terrain pri_sim_4] gulag: beginJob: obj=sim_default_zombied_111887 job= logic@pri_sim_4_guard_1_walk[smart_terrain pri_sim_4] register called obj=sim_default_zombied_111899filling npc_info for obj [sim_default_zombied_111899][smart_terrain pri_sim_4] gulag: beginJob: obj=sim_default_zombied_111899 job= logic@pri_sim_4_walker_1_walkSquad 11886 enter smart pri_sim_4. Quan = 0

значит...нифига не ясно:)

апд:
опять подключил алайф симулятор...вылетает при создании сталкера, но есть мысль - может попробовать создавать через функции алайфа... 

апд:
т.к. подключил алайф, проверю работоспособность самого мп...вообще реально ли зайти на сервер и прочее, а также разобраться с не выделенным сервером (почему то вылетает при включении)...
выделенный сервер: спавн игрока работает, бегал всё такое, но когда должен был умереть сервер слетел...наверно как то связано со скриптами...xrServer::Process_Event_Destroy есть в конце условие на существование CALifeSimulator и при его наличии используется CALifeObjectRegistry который почему-то не существует...всё таки надо найти где он создаётся и заставить его работать...
попробую отыскать указатель на CALifeObjectRegistry в симуляторе алайфа:
this > this+0x48 > this > this+() 

CALifeObjectRegistry:
CALifeSimulator = CAI_Space + 0x14;
UnknownID = *(DWORD*)(*(DWORD*)(CALifeSimulator + 0xC) + 4);	// 105118D8

*(DWORD*)(CALifeSimulator + 0x20 + UnknownID) + 4

апд:
на данный момент ВСЕ видимые проблемы изза кривого АлайфСимулятора, тупо не создается CALifeObjectRegistry (указатель = 0)

09.11.11:
нашел где создаётся CALifeObjectRegistry, сделал его создание в мп, теперь появляются другие мини проблемы. не знаю что отключить а что оставить в загрузке алайфа...не хватает в CALifeUpdateManager чегото

апд:
то чего не хватает апдейт менеджеру кроется в sub_100A5CF0, но он не хочет нормально работать без объектов (вечный цикл...)

10.11.11:
линковка ai()+0x4 в 10227A40 и линкуется указатель на геймграф...и кстати всё это вызывается у меня в хуке...странно =/ а ну да, это грузится позже на много...значит вернём load_0 в список обрабатываемых функций, пустим как параметр строку all...ну и тогда не требуется загрузка гейм графа, только лоад АИ спейса :)
загрузка алайфа нормально проходит, но драный валет в апдейт менеджере остался!
короче...вырублю апдейт менеджер, погляжу какова реакция будет ><
вырубил апдейт менеджер, работать всё стало, но пока не могу увидеть грёбаных ботов >< ГДЕ ЭТИ ИДИОТЫ???

апд:
алайф работает, теперь требуется: 
1. заставить алайф держать объекты всегда в онлайне
2. убрать вызов калбеков для акторов (мп акторы не должны цепляться к алайфу)

11.11.11:
перед дальнейшими мучениями с текущим алайфом, попробую вырубить CALifeUpdateManager::update в сингле и увидеть какой результат я должен получить у себя при верной работе всего что имею...

апд: не получится посмотреть это...изза того что апдейт менеджер вырублен актор не линкуется, в результате метод actor() равен нулю и мы благополучно вылетаем в xr_effects.script

CALifeUpdateManager один из базовых у CALifeSimulator и обасть данных апдейт менеджера в самом начале алайф симулятора => 
UnknownID = *(DWORD*)(*(DWORD*)(CALifeSimulator + 0xC) + 4);	// 105118D8
- опять тот неизвестный айди...
далее...
UnkPointer = *(DWORD*)(CALifeSimulator + UnknownID + 0x24) - указатель опять на какую то чудесную херотень...и дальше
*(DWORD*)(UnkPointer + 0x3010) - вот он класс который не имеет необходимых нам данных и выдаёт слёт...сучёнок

вот этот UnkPointer как раз и использовался sub_100A5CF0...но что же не так???

апд:
и так...поставил загрузку алл.спавна и вернул полностью рабочий A5CF0..и в итоге все работает только получаем ошибку в переходе в онлайн изза несовпаденя левел вертексов (упся...)

апд:
переключил карту на zaton...ну что я могу сказать...проекты пересеклись..soCoop & soNetwork...если идти в сторону поправки проблем не убирая толпу мудаков в олл.спавн то соберём кооп...если убрать загрузку из олл спавна и чинить проблемы то соберем ботов для сетевой...т.к. никто не знает про кооп то делаем ботов, а кооп потом выльется в виде хита :) мечты мечты...

и так: убираем загрузку ботов и ищем проблемы в 100A5CF0, там где мы перескакиваем жуткий цикл есть нужное нам создание класса... + 0x3010 его смещение...как бы подобраться к этому Г...
такое чувство будто по этому смещению какойто объект должен находиться...СХУЯ?

может попробывать убрать именно эти вызовы...ну для этого смещения?вдруг проканает...может это актор к примеру ><

апд: проканало...больше не вылетает, зайти могу бегать тоже...теперь разбираться с самими ботами...
bloodsucker_online: crash, 0x3DB63F0
boar_online: crash, 0x3BE63F0
burer_online: crash, 0x3E063F0
chimera_online: crash, 0x3C963F0
controller_online: crash, 0x3D863F0
crow_online: crash, 0x3CA63F0
dog_online: crash, 0x3B963F0
flesh_online:
gigant_online:
pseudodog_online:
poltergeist_online_tele:
poltergeist_online_flame:
snork_online:
stalker_online:
tushkano_online:
car_online:

FUCK! при создании объекта, выдаёт ошибку в CALifeObjectRegistry::object...надо мучить этот обжект регистри, класса нет, там ноль передаётся...вызывается из 100B2760...СУКА!ДРАНЫЙ 0x3010!ЕГО НАДО ЛОМАТЬ БЛЯТЬ!
*(_DWORD *)(*(_DWORD *)(*(_DWORD *)(*(_DWORD *)(v12 + 0xC) + 0x4) + v12 + 0x24) + 0x3010) + 0x8
вот этот драный CALifeObjectRegistry

3010 create в:
10ABFA6(create new game) -> 10A403E -> 10AFEA0 -> 10AFE69 -> 10AFD55 -> 100B1E97 -> 100B1078 -> 1021FCE1 -> 1021F9A0 -> 102252A0 -> ... -> 101F29F7 -> 101F2285 -> 101F1F9E -> xrGame:0x101F1A10 -> CInIFile::load -> 18766 -> 17B7B -> 1A2D0 -> xrCore: 1A5A4

12.11.11:
на счёт кооператива: грузилось всё на затон думаю потому что левелид у карт в мп всегда 0 (ну или 1) короче начальный, и это соответствует затону...
ну а теперь продолжаем драть нетворк:
нашел где создаётся 3010...в CALifeGraphRegistry::setup_current_level, теперь надо узнать откуда его зовут...и кстати в конце он сам вызывает CAI_Space::Load

Invalid flag M_SPAWN_OBJECT_ASPLAYER for non-actor object!

заветная строчечка...значит все проблемы от того что я убрал загрузку all.spawn в котором как я полагаю самым первым идёт актор, с флагом спавна как игрока...весело ><
*(_DWORD *)(v2 + 0x3014) = v3; - означает что актора записывает в класс...жаль, но прийдётся обломить их :D
сделаю вместо простого CAI_Space::Load сетап каррент левл...в том случае что у нас сервер :)

апд: получил ошибку...надо чтоб актор был закреплен...мммммммммм.....крепится ентити...можно похимичить...

апд: готово...алайф работает...НО...изза смены айди на какоето время в результате получаем жуткую жопу вместо карты, и айди у карты был не тот поэтому монстры как в затоне бегают...полный экшн

апд: запустил затон, всё красиво и правильно...карта без косяков, монстры бегают как надо...бойня кровососы против контроллёры получилась...и контроллёры против снорков тоже :D

апд: в попытках изменить загрузку уровня изменил нахер кросстабл...охрененно ><
*(DWORD*)(g_pAI_Space + 0x4) + 0x1F - кросс табл, не менять бля

13.11.11:
для определения вертекса на уровне можно использовать CLevelGraph::vertex(vector postion) но для гейм вертекса пока даже не знаю...

Разберемся с крешем припяти...вылетает на загрузке HOM, это в Render::level_load
IGame_Level::Load -> Render::level_load

апд: оказалось не в хом дело...а в CEnvironment::mods_load...

апд: и так, алайф полностью работает, монстры активны...теперь надо разобраться с вылетом при смерти игроков и с вылетами у некоторых монстров...**здец...начну с перехода на выделенный сервер, задрало уже вводить старт сервер...

13.12.11:
решаю вылеты игры...сделал спавн через смарт террейны всех монстров...в итоге получаем все реальные вылеты сразу...исправляю их, довожу до спокойной работы при постоянном спавне монстров и вечной войне оных...и можно играть :)

18CCA0 (eax + 0x18) -> 808EC (this + 0x2C) -> 80436 (arg0) -> 7FFC1 (arg0) -> 7E378 (*(*arg0 + 0x30) -> 50ECA (arg0)

попадаем в CCoverManager + 0x38 равен нулю...(в 808D0)

в 808D0 аргументом передаётся название смарт кавера (в сингле передалось zat_smart_cover_0244)
надо понять какого чёрта не идёт верным боком...

1714E7 -> 173F32 -> 18CCA0 -> 808D0 ... 

меняется бест_кавер в 18F12C
а не верное значение даётся в 18F0D9

а значит проблема всё таки в кавер менеджере...хи хи хи :D смерть ему! казнь! победа будет за нами!!! для начала нужно проверить какие параметры передаются в функцию

и так параметры (проверено в сингле):
1 - вектор координат (указатель)
2 - 41200000
3 - неизвестный класс с таблицей 52D8A4
4 - массив (структура?) первое поле - указатель на объект (сталкер) второе - чтото странное непонятное

теперь поглядим что в мп...

1 - вектор координат (+)
2 - 41200000 (+)
3 - неизвестный класс с таблицей 52D8A4 (+)
4 - (+)

значит херню какую то получаем при CStalkerMovementRestrictor::CStalkerMovementRestrictor

ой тупанул..там всего же 4 параметра, эта хрень это бред...значит параметры все верные...что то идёт дальше

14.12.11:
на 18CC18 в ecx суётся левая хрень...там должен быть айди или лвл вертекс вроде...но в мп бред какойто + дальше там строка есть с названием смарт кавера...т.е. в 18CC10 попадает кривой аргумент...надо разбираться какого хуя...а это всё значит что CAI_Stalker::best_cover возвращает не то значене которое надо ><

апд: пиф паф! попал на данные при ошибке....по адресу аргумента0 в 18CC10 вообще строка (ВТФ?) точнее стринг_контейнер т.е. в 3C33F10 в edi хрень какая то...точнее edi + 0x34 это аргумент тот левый

апд: короче как не крути а проблема в CCoverManager::best_cover_CCoverEvaluatorBest_CStalkerMovementRestrictor_... надо узнать в каких случаях и какого чёрта он возвращает значение больше 0x1FFFFFFF

16A106 - запись нового значения...НО тут говняное значение не пишется...да нигде не пишется в esi+4 не верное значение...странно, не понятно...

15.12.11:
проверка на изменение ESI во время работы функции (значение переданное в аргумент сравниваем с текущим): Dword(ESP + 0x14 + 0xC) != ESI

еще кстати тут бывают вылеты при втором респе: 34601C

апд: проверил еси на изменение...не меняется он...почему же тогда такой бред...

апд: устанавливается левое значение в CCoverEvaluatorBest::evaluate

апд: в 169A60 первым аргументом попадает странная неведомая херня которая бля вылетает ... и её записывают в результат млэ...

апд: убрал вызов этой функции...первый тест прошёл нормально, но при втором респе опять вылет в 34601C...погляжу что откуда, если конечно не всплывёт беда с укрытиями...

4143B6(xrEngine) -> 161AF9 -> 95D7D -> 933C2 -> 93231 -> 925B1 -> 34601C

апд: выключил CAgentManager::update ... вылеты пропали..НО:
то что я вырубил эти 2 функции не решает полностью проблему...надо искать причину а не убирать функции использующие хреновые данные >< позже буду разбираться с причинами, если всё таки чтото нужное задел...

24.12.11:
разобрался с зачетами, продолжаю мучить сталкера...сделал аи сетку для мп_припяти и собрал нужный спавн с геймграфом только припяти...теперь исправляю вылеты, щас вылеты изза получения звука (CMonsterSoundMemory::GetSound_0) уберу вызов его...

25.12.11:
разбираюсь с вылетами у клиента...начал с простого - оставил спавн только кабанов и вуаля - зашёл на сервер и спокойно играл, но заметил проблемку: сквозь кабанов можно пройти и они не могут нанести урон (ЧТО ЗА ХЕРНЯ?), надо отметить это...

апд: можно брать название уровня от сюда: * HOST #1: mp_pripyat

апд: оказались все проблемы от самого мелкого и гадского монстра - тушкана...вылеты хер пойми откуда да почему